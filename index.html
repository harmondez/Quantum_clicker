<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quantum Clicker: Ultimate Edition</title>
    <link rel="stylesheet" href="styles.css">
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <!-- AVISO DE FOTOSENSIBILIDAD / EPILEPSIA -->
    <div id="modal-epilepsy" class="modal-overlay" style="display:none; z-index: 99999; background: rgba(0,0,0,0.95);">
        <div class="modal-box" style="border-color: #ffd700; max-width: 520px; text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 10px;">‚ö†Ô∏è</div>
            <h2 style="color: #ffd700; border: none; margin-bottom: 5px; font-size: 1.4rem;">AVISO DE FOTOSENSIBILIDAD</h2>
            <p style="color: #ccc; font-size: 0.95rem; line-height: 1.6; margin: 15px 0;">
                Este juego contiene <strong style="color:#ff5252;">efectos visuales intensos</strong>: 
                destellos luminosos, parpadeos r√°pidos, cambios bruscos de color, 
                vibraciones de pantalla y efectos de bloom.
            </p>
            <p style="color: #00e5ff; font-size: 1.1rem; margin: 20px 0; font-weight: bold; text-shadow: 0 0 10px rgba(0, 229, 255, 0.5);">
                ‚ö†Ô∏è PARA INICIAR: Haz click 100 veces en el n√∫cleo para estabilizarlo.
            </p>
            <p style="color: #ff9100; font-size: 0.85rem; margin-bottom: 20px;">
                Si padeces <strong>epilepsia fotosensible</strong> u otra condici√≥n sensible a est√≠mulos visuales, 
                te recomendamos activar el <strong>Modo Seguro</strong>.
            </p>
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button onclick="acceptSafeMode()" style="padding: 14px; background: #1b5e20; border: 2px solid #4caf50; color: #fff; font-weight: bold; font-size: 1rem; cursor: pointer; border-radius: 8px;">üõ°Ô∏è ACTIVAR MODO SEGURO (efectos reducidos)</button>
                <button onclick="acceptNormalMode()" style="padding: 12px; background: transparent; border: 1px solid #555; color: #aaa; font-size: 0.9rem; cursor: pointer; border-radius: 8px;">Continuar con efectos completos</button>
            </div>
            <p style="color: #666; font-size: 0.7rem; margin-top: 15px;">
                Puedes cambiar esta opci√≥n en cualquier momento desde el bot√≥n üõ°Ô∏è en la barra inferior.
            </p>
        </div>
    </div>

    <div id="intro-layer">
    <div id="intro-text"></div>
    </div>

    <div id="news-ticker"><div id="news-content">Cargando noticias del multiverso...</div></div>
    <div id="notification-area"></div>

    <div id="game-area">
        <div id="buff-container" style="display: none;">
        <div id="buff-bar"></div>
        <div id="buff-text">SOBRECARGA ACTIVA</div>
        </div>
        
        <div id="anomaly-notifications"></div>

        <canvas id="three-canvas"></canvas>

        <div id="prestige-hud">‚ö° Multiplicador Cu√°ntico: <span id="prestige-display">x1.0</span></div>

        <div class="hud-overlay">
            <div id="score">0</div>
            <div id="cps-display">0.0 / seg</div>
            <div id="combo-display">COMBO x1.0</div>
            
            <div id="galacticoins-hud" style="display: none; background: rgba(0,0,0,0.7); border: 1px solid #ffd700; color: #ffd700; padding: 2px 8px; border-radius: 4px; font-size: 0.9rem; margin-top: 8px; width: fit-content; box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); font-family: monospace; font-weight: bold; white-space: nowrap;">
                ü™ô <span id="gc-amount">0</span>
            </div>
        </div>

        <div id="pearls-container">
            <div id="slot-red" class="pearl-slot locked" onclick="togglePearl('red')">
                <div class="pearl-icon">üî¥</div>
                <div class="pearl-tooltip">PERLA ROJA<br>Vac√≠a</div>
            </div>
            
            <div id="slot-blue" class="pearl-slot locked" onclick="togglePearl('blue')">
                <div class="pearl-icon">üîµ</div>
                <div class="pearl-tooltip">PERLA AZUL<br>Vac√≠a</div>
            </div>
            
            <div id="slot-green" class="pearl-slot locked" onclick="togglePearl('green')">
                <div class="pearl-icon">üü¢</div>
                <div class="pearl-tooltip">PERLA VERDE<br>Vac√≠a</div>
            </div>
            
            <div class="level-system" style="padding: 15px; background: rgba(0,0,0,0.3); border-bottom: 1px solid #333;">
                <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 5px;">
                    <div style="display: flex; flex-direction: column;">
                        <span style="color: var(--accent); font-size: 0.65rem; text-transform: uppercase; letter-spacing: 2px; font-weight: bold;">Rango de Comandante</span>
                        <span id="player-level-text" style="color: #fff; font-size: 1.2rem; font-weight: 900; font-family: 'Orbitron', sans-serif;">NIVEL 1</span>
                    </div>
                    <span id="level-percentage" style="color: #888; font-size: 0.75rem; font-family: monospace;">0%</span>
                </div>
                <div class="progress-bg" style="width: 100%; height: 6px; background: #1a1a1a; border-radius: 10px; overflow: hidden; border: 1px solid #333;">
                    <div id="level-bar-fill" style="width: 0%; height: 100%; background: linear-gradient(90deg, #00ff88, #00bd65); box-shadow: 0 0 10px rgba(0,255,136,0.5); transition: width 0.3s ease;"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="store-area">
        <h2>Mejoras</h2>
        <div id="upgrades-panel">
            <div style="color:#444; font-size:0.7rem; width:100%; text-align:center;">Juega para desbloquear tecnolog√≠a</div>
        </div>

        <h2>Estructuras</h2>
        <div id="buildings-list"></div>

        <h2>Equipo</h2>
        <div id="staff-feed" style="height: 35px; font-style: italic; color: #00ff88; text-align: center; margin: 15px; font-size: 0.8rem;">
    Esperando √≥rdenes del equipo...
        </div>
        <div id="helpers-list" class="locked-section"></div>

        <div id="save-controls">
            <button class="sys-btn" onclick="toggleInventory()" title="Mochila Espacial" style="flex: 0.4; background: #263238; border-color: #37474f; font-size: 1.2rem;">üéí</button>
            
            <button class="sys-btn" onclick="toggleCollection()" ...>üìñ</button>
            <button class="sys-btn" onclick="toggleCollection()" title="C√≥dice (Colecci√≥n)" style="flex: 0.4; background: #3e2723; border-color: #5d4037; font-size: 1.2rem;">üìñ</button>
            <button id="btn-stats" class="sys-btn" onclick="openStats()">üìä Stats</button>
            <button class="sys-btn" onclick="toggleAchievements()" title="Logros" style="flex: 0.4; background: #004d40; border-color: #00695c; font-size: 1.2rem;">üèÜ</button>
            <button class="sys-btn" onclick="openSettings()" title="Ajustes" style="flex: 0.4; font-size: 1.2rem;">‚öôÔ∏è</button>
            <button class="sys-btn" onclick="exportSave()" title="Exportar Partida">üì§</button>
            <button class="sys-btn" onclick="importSave()" title="Importar Partida">üì•</button>
            <button class="sys-btn" id="btn-prestige" onclick="doPrestige()">Ascender</button>
            <button class="sys-btn" onclick="saveGame()">Guardar</button>
            <button class="sys-btn" onclick="resetGame()" style="color: var(--danger);">Reset</button>
        </div>

        <!-- RADIO MINI-PLAYER (siempre visible) -->
        <div id="radio-mini" class="radio-mini" onclick="openSettings()">
            <span id="radio-mini-icon">üîá</span>
            <span id="radio-mini-text" class="radio-mini-marquee">Radio apagada</span>
        </div>
    </div>

    <div id="modal-achievements" class="modal-overlay" onclick="if(event.target === this) toggleAchievements()">
        <div class="modal-box">
            <div class="close-btn" onclick="toggleAchievements()">√ó</div>
            <div class="modal-header">
                <h2>üèÜ Galer√≠a de Trofeos</h2>
                <div class="achievement-stats">
                    <span id="ach-count">0 / 0</span>
                    <span id="ach-bonus" style="color:var(--neon-green)">Bonus: 0%</span>
                </div>
            </div>
            
            <div class="ach-controls" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <div class="ach-tabs" style="margin-bottom:0; border-bottom:none;">
                    <button class="ach-tab active" onclick="filterAchievements('all')">Todos</button>
                    <button class="ach-tab" onclick="filterAchievements('building')">Edificios</button>
                    <button class="ach-tab" onclick="filterAchievements('energy')">Econom√≠a</button>
                    <button class="ach-tab" onclick="filterAchievements('special')">Especiales</button>
                </div>
                <label style="color:#aaa; font-size:0.8rem; cursor:pointer; display:flex; align-items:center; gap:5px;">
                    <input type="checkbox" id="ach-hide-locked" onchange="renderAchievements()"> 
                    üëÅÔ∏è Ocultar Bloqueados
                </label>
            </div>

            <div id="achievements-list" class="achievements-list">
                <!-- Se rellena con JS -->
            </div>
        </div>
    </div>

    <div id="modal-ascension" class="modal-overlay">
        <div class="modal-box" style="border-color: #7c4dff;">
            <div class="close-btn" onclick="closeAscension()">√ó</div>
            <h2 style="color: #b388ff; border:none;">üåÄ ASCENSI√ìN CU√ÅNTICA</h2>
            <div class="antimatter-icon">‚öõÔ∏è</div>
            <div class="ascension-info">
                Al ascender, tu universo colapsar√° y renacer√°.<br>
                Perder√°s edificios, mejoras y energ√≠a.<br>
                Ganar√°s <b>Antimateria</b> y un <b>Multiplicador Permanente</b>.
            </div>
            <div style="background:#111; padding:15px; border-radius:8px; text-align:left;">
                <div class="stat-row">
                    <span>Energ√≠a Acumulada:</span> <span id="asc-total-cookies">0</span>
                </div>
                <div class="stat-row">
                    <span>Multiplicador Actual:</span> <span id="asc-current-mult">x1.0</span>
                </div>
                <div style="text-align:center; margin-top:15px;">
                    <div class="gain-text">+<span id="asc-gain-antimatter">0</span> Antimateria</div>
                    <div style="color:var(--accent); font-size:0.9rem;">(Nuevo Bonus: x<span id="asc-new-mult">0</span>)</div>
                </div>
            </div>
            <button onclick="confirmAscension()" class="reincarnate-btn" style="width:100%; margin-top:20px;">¬°ASCENDER AHORA!</button>
        </div>
    </div>

    <div id="modal-system" class="modal-overlay" style="z-index: 3000;">
        <div class="modal-box" style="border-color: #ff5252; min-width: 320px;">
            <h3 id="sys-title" style="margin-top: 0; color: #ff5252;">‚ö†Ô∏è ALERTA</h3>
            <p id="sys-msg" style="color: #ddd; font-size: 1rem; margin: 20px 0;">Mensaje...</p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button id="sys-btn-cancel" onclick="closeSystemModal()" style="display: none; padding: 10px 20px; background:transparent; border:1px solid #555; color:#aaa; cursor:pointer;">CANCELAR</button>
                <button id="sys-btn-ok" style="background: var(--accent); border: none; color: #000; font-weight: bold; padding: 10px 20px; cursor: pointer;">ACEPTAR</button>
            </div>
        </div>
    </div>


    <div id="modal-collection" class="modal-overlay" style="z-index: 2500;">
        <div class="modal-box" style="width: 750px; max-width: 95%; max-height: 85vh; overflow-y: auto;">
            <div class="close-btn" onclick="toggleCollection()">√ó</div>
            <h2 style="color: #ffd700; border-bottom: 1px solid #555; margin-bottom: 20px;">üìñ C√≥dice Cu√°ntico</h2>

            <h3 style="text-align: left; color: #00e5ff; font-size: 1rem; margin-top: 10px;">üíé ARTEFACTOS DE LA TRINIDAD</h3>
            <div id="collection-artifacts" class="collection-grid"></div>

            <h3 style="text-align: left; color: #ff9100; font-size: 1rem; margin-top: 25px;">üë• PERSONAL CONTRATADO</h3>
            <div id="collection-helpers" class="collection-grid"></div>

            <h3 style="text-align: left; color: #aaa; font-size: 1rem; margin-top: 25px;">‚öôÔ∏è TECNOLOG√çA DESCUBIERTA</h3>
            <div id="collection-upgrades" class="collection-grid"></div>
        </div>
    </div>
    

    <div id="modal-heaven" class="modal-overlay" style="z-index: 9000;">
        <div class="heaven-modal-box">
            <div class="heaven-header">
                <div>
                    <h2 style="color: #d1c4e9; margin:0;">üåå Plano Celestial</h2>
                    <div style="color: #b388ff; font-size: 0.9rem;">
                        Antimateria: <span id="heaven-antimatter" style="color:#fff; font-weight:bold;">0</span> 
                        <span style="color:#666;">(Nivel: <span id="heaven-level">0</span>)</span>
                    </div>
                </div>
                
            </div>
            <div id="heaven-tree-container">
                <canvas id="heaven-canvas"></canvas>
                <div id="heaven-nodes"></div>
            </div>
            <div id="heaven-tooltip" class="heaven-tooltip"></div>
            <div class="heaven-footer">
                <button onclick="finishAscension()" class="reincarnate-btn">üß¨ REENCARNAR</button>
            </div>
        </div>
    </div>


    
    <div id="global-tooltip" class="global-tooltip"></div>

    <!-- MODAL DE AJUSTES -->
    <div id="modal-settings" class="modal-overlay" style="display:none;">
        <div class="modal-box" style="max-width: 480px; text-align: left;">
            <div class="close-btn" onclick="closeSettings()">√ó</div>
            <h2 style="color: #00e5ff; border: none; text-align: center; font-size: 1.1rem; margin-bottom: 15px;">‚öôÔ∏è AJUSTES</h2>

            <!-- SECCI√ìN: RADIO -->
            <div class="settings-section">
                <h3 class="settings-title">üìª RADIO</h3>
                
                <div class="radio-player">
                    <div class="radio-now-playing">
                        <span id="radio-status-icon">‚è∏Ô∏è</span>
                        <span id="radio-station-name">Sin emisora</span>
                    </div>

                    <div class="radio-controls">
                        <button id="btn-radio-toggle" class="radio-btn" onclick="toggleRadio()" title="Play/Pause">‚ñ∂Ô∏è</button>
                        <input id="radio-volume" type="range" min="0" max="100" value="30" class="radio-slider" oninput="setRadioVolume(this.value)">
                        <span id="radio-volume-label" style="color:#888; font-size:0.75rem; min-width:30px;">30%</span>
                    </div>
                </div>

                <div class="radio-stations">
                    <label class="settings-label">Emisora:</label>
                    <select id="radio-station-select" class="settings-select" onchange="changeStation(this.value)">
                        <option value="">‚Äî Seleccionar ‚Äî</option>
                        <option value="nightride">üåÉ Nightride FM (Synthwave)</option>
                        <option value="chillsynth">üåå Nightride Chillsynth</option>
                        <option value="ebsm">‚ö° Nightride EBSM (Dark Synth)</option>
                        <option value="spacestation">üõ∏ SomaFM Space Station</option>
                        <option value="defcon">üíÄ SomaFM DEF CON Radio</option>
                        <option value="vaporwaves">üåä SomaFM Vaporwaves</option>
                        <option value="custom">üîó URL Personalizada...</option>
                    </select>
                </div>

                <div id="custom-url-section" style="display:none; margin-top: 8px;">
                    <label class="settings-label">URL del stream:</label>
                    <div style="display:flex; gap:6px;">
                        <input id="radio-custom-url" type="url" class="settings-input" placeholder="https://stream.example.com/radio.mp3">
                        <button class="radio-btn" onclick="applyCustomUrl()" style="padding: 0 12px;">OK</button>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN: ACCESIBILIDAD -->
            <div class="settings-section">
                <h3 class="settings-title">üõ°Ô∏è ACCESIBILIDAD</h3>
                
                <!-- Master toggle -->
                <div class="settings-row" style="margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 10px;">
                    <div>
                        <span style="color:#ffd700; font-size:0.9rem; font-weight:bold;">Modo Seguro (TODO)</span>
                        <p style="color:#888; font-size:0.7rem; margin: 2px 0 0 0;">Activa o desactiva todos los efectos a la vez.</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="toggle-safe-mode" onchange="toggleSafeMode()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <!-- Controles individuales -->
                <div class="safe-settings-grid">
                    <label class="safe-setting-item">
                        <input type="checkbox" id="safe-noBloom" onchange="toggleSafeSetting('noBloom')">
                        <span>üí° Reducir Bloom (resplandor)</span>
                    </label>
                    <label class="safe-setting-item">
                        <input type="checkbox" id="safe-noFlash" onchange="toggleSafeSetting('noFlash')">
                        <span>‚ö° Sin Flash-Bang (pantallazos)</span>
                    </label>
                    <label class="safe-setting-item">
                        <input type="checkbox" id="safe-noGlitch" onchange="toggleSafeSetting('noGlitch')">
                        <span>üñ•Ô∏è Sin Glitch (inversi√≥n colores)</span>
                    </label>
                    <label class="safe-setting-item">
                        <input type="checkbox" id="safe-noShake" onchange="toggleSafeSetting('noShake')">
                        <span>üì≥ Sin Vibraci√≥n de c√°mara</span>
                    </label>
                    <label class="safe-setting-item">
                        <input type="checkbox" id="safe-noParticles" onchange="toggleSafeSetting('noParticles')">
                        <span>‚ú® Reducir Part√≠culas</span>
                    </label>
                    <label class="safe-setting-item">
                        <input type="checkbox" id="safe-noAnimations" onchange="toggleSafeSetting('noAnimations')">
                        <span>üé≠ Reducir Animaciones CSS</span>
                    </label>
                    <label class="safe-setting-item">
                        <input type="checkbox" id="safe-noTicker" onchange="toggleSafeSetting('noTicker')">
                        <span>üì∞ Parar News Ticker</span>
                    </label>
                </div>
            </div>

        </div>
    </div>

    <script type="module" src="game.js"></script>
    <div id="modal-stats" class="modal-overlay" style="display:none;">
    <div class="modal-box">
        <div class="close-btn" onclick="closeStats()">√ó</div>
        <h3>üìä REPORTE DE RENDIMIENTO</h3>
        <div id="stats-content">
            </div>
    </div>
    </div>
    <div id="scene-blocker" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:9999; background:rgba(0,0,0,0.2);"></div>


    <div id="modal-inventory" class="modal-overlay" style="display:none; z-index: 3000;">
        <div class="modal-box" style="border-color: #ffd700; width: 420px; max-width: 95%;">
            <div class="close-btn" onclick="toggleInventory()">√ó</div>
            
            <h2 style="color: #ffd700; border: none; margin-bottom: 10px; font-size: 1.2rem;">üéí MOCHILA GAL√ÅCTICA</h2>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: rgba(0,0,0,0.4); padding: 10px; border-radius: 4px; border: 1px solid #333;">
                <div style="color: #ffd700; font-weight: bold; font-size: 1.1rem; font-family: monospace;">
                    ü™ô <span id="gc-modal-amount">0</span> <small style="font-size: 0.7rem; color: #888;">GC</small>
                </div>
                <button onclick="sellAllTrash()" class="sys-btn" style="background: #1a1a1a; font-size: 0.6rem; padding: 4px 8px; color: #ff5252; border-color: #444;">
                    VENDER CHATARRA
                </button>
            </div>

            <div id="inventory-grid" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; background: #000; padding: 8px; border-radius: 4px; border: 1px solid #222; min-height: 200px;">
                </div>
            
            <div style="margin-top: 10px; text-align: right; font-size: 0.7rem; color: #555; font-family: monospace;">
                CAPACIDAD: <span id="inv-usage">0</span> / 30
            </div>
        </div>
    </div>
</body>
</html>